# 凱基銀行法務條款管理系統 - 完整專案上下文

## 📋 專案概述

**目標**：建立智能化條款比對與差異分析系統，讓法務人員能快速識別新案件與歷史案件的條款差異，並獲得專業建議。

**核心需求**（法務原話）：
> "我們要去找相同的地方，相同的就直接填入條款書，不同的把它驗出來，去觀察『為什麼不同』，根據觀察到的不同原因，去做刪減或增加。"

## 🎯 業務流程

```
新案件文檔 → 條款提取 → 歷史比對 → 差異分析 → 原因推斷 → 行動建議 → 法務確認
```

## 📁 原始文檔（請基於這些真實文檔進行開發）path: /Users/kevinluo/kgi_test_sunday/原始文檔

### 文檔1：初始方案解決策略
```
[貼入完整的初始方案解決策略文檔內容]
```

### 文檔2：批覆書_大企_信用
```
[貼入完整的批覆書_大企_信用文檔內容]
```

### 文檔3：批覆書_大企_擔保
```
[貼入完整的批覆書_大企_擔保文檔內容]
```

### 文檔4：批覆書_商金_信用
```
[貼入完整的批覆書_商金_信用文檔內容]
```

### 文檔5：批覆書_商金_擔保
```
[貼入完整的批覆書_商金_擔保文檔內容]
```

### 文檔6：授信條件約定書_商金
```
[貼入完整的授信條件約定書_商金文檔內容]
```

### 文檔7：授信條件約定書_大企
```
[貼入完整的授信條件約定書_大企文檔內容]
```

## 🔧 技術架構確認

### 已確定的技術選型
- **主框架**：LangGraph（用於步驟化工作流）
- **LLM**：Google Gemini 2.5 Pro（用於條款分析）
- **資料庫**：SQLite（初期）→ PostgreSQL（擴展期）
- **後端**：Python + FastAPI
- **前端**：建議 React + TypeScript

### 核心工作流節點
1. **extract_new_clauses** - 提取新案件條款
2. **load_historical_clauses** - 載入歷史案件條款  
3. **match_similar_clauses** - 配對相似條款
4. **analyze_differences** - 分析差異
5. **generate_recommendations** - 生成建議
6. **human_review** - 人工審核點
7. **generate_final_report** - 生成最終報告
8. **save_results** - 儲存結果

## 📊 資料庫設計

### 核心資料表
```sql
-- 案件表
CREATE TABLE cases (
    id INTEGER PRIMARY KEY,
    case_name TEXT NOT NULL,
    case_type TEXT NOT NULL, -- '大企_信用', '大企_擔保', '商金_信用', '商金_擔保'
    client_name TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 條款表
CREATE TABLE clauses (
    id INTEGER PRIMARY KEY,
    case_id INTEGER,
    category TEXT NOT NULL, -- '授信種類及額度', '利費率', '期限', '還本付息', '連帶保證人', '擔保品', '特約條件'
    original_text TEXT NOT NULL,
    standardized_text TEXT,
    parameters JSON, -- 提取的參數（金額、利率等）
    risk_level TEXT, -- 'low', 'medium', 'high'
    FOREIGN KEY (case_id) REFERENCES cases (id)
);

-- 比對歷史表
CREATE TABLE comparisons (
    id INTEGER PRIMARY KEY,
    new_case_id INTEGER,
    reference_case_id INTEGER,
    clause_category TEXT,
    similarity_score REAL,
    difference_type TEXT, -- 'parameter', 'structure', 'missing', 'new'
    action_taken TEXT, -- 'keep_current', 'use_historical', 'modify', 'delete', 'add_new'
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (new_case_id) REFERENCES cases (id),
    FOREIGN KEY (reference_case_id) REFERENCES cases (id)
);
```

## 🎨 UI/UX 需求

### 法務工作介面需求
1. **文檔上傳區** - 支援拖拽上傳新案件文檔
2. **即時分析狀態** - 顯示工作流執行進度
3. **條款比對視圖** - 並排顯示新舊條款差異
4. **差異高亮顯示** - 用顏色標示不同類型的差異
5. **建議操作面板** - 顯示系統建議和一鍵操作按鈕
6. **人工確認介面** - 法務可以接受/拒絕/修改建議
7. **最終報告導出** - 支援 Word/PDF 格式

### 關鍵功能需求
```typescript
// 條款比對結果顯示
interface ClauseComparisonView {
  category: string;
  status: 'identical' | 'similar' | 'different' | 'missing' | 'new';
  newClause?: string;
  historicalClause?: string;
  differences: string[];
  recommendation: {
    action: string;
    reasoning: string;
    confidence: number;
  };
  humanReviewRequired: boolean;
}
```

## 🔄 具體實現要求

### Phase 1: 核心功能（MVP）
- [ ] LangGraph 工作流建立
- [ ] 條款提取和分類功能
- [ ] 基本的條款比對邏輯
- [ ] SQLite 資料庫整合
- [ ] 簡單的 Web 介面

### Phase 2: 進階功能
- [ ] 智能差異分析
- [ ] 原因推斷邏輯
- [ ] 人工審核流程
- [ ] 報告生成和導出

### Phase 3: 優化功能
- [ ] 批次處理能力
- [ ] 統計分析功能
- [ ] 使用者權限管理
- [ ] 系統效能優化

## 💡 技術實現提示

### Prompt Engineering 要點
1. **角色設定明確** - "你是凱基銀行資深法務專家"
2. **輸出格式嚴格** - 強制 JSON 格式，便於程式處理
3. **專業術語準確** - 使用正確的銀行業法務術語
4. **分步驟處理** - 每個節點專精單一任務

### 差異分析邏輯
```python
def analyze_difference_reason(old_value, new_value, parameter_type):
    """
    根據參數類型和數值變化推斷原因
    
    金額變化 → 客戶風險等級、業務規模、擔保品價值
    利率變化 → 市場環境、客戶評等、銀行政策
    期限變化 → 業務週期、風險控制、法規要求
    """
```

### 人工介入點設計
```python
# 觸發人工審核的條件
human_review_triggers = [
    "風險等級為 high",
    "差異超過 3 個參數",
    "新增前所未見的條款",
    "缺少常見的重要條款",
    "信心度低於 80%"
]
```

## 🎯 成功標準

### 功能性指標
- [ ] 條款提取準確率 > 90%
- [ ] 條款分類準確率 > 85%
- [ ] 差異識別完整率 > 95%
- [ ] 建議操作合理性 > 80%

### 使用者體驗指標
- [ ] 單個案件處理時間 < 5 分鐘
- [ ] 法務滿意度 > 4/5
- [ ] 學習成本 < 1 小時
- [ ] 系統穩定性 > 99%

## 📝 特別注意事項

### 銀行業務特點
1. **精確性要求極高** - 條款一字不差很重要
2. **合規性至關重要** - 所有建議都要符合法規
3. **風險敏感度高** - 寧可保守也不要遺漏風險
4. **稽核軌跡完整** - 所有決策過程要可追蹤

### 法務工作習慣
1. **喜歡並排比較** - 新舊文件同時顯示
2. **需要詳細說明** - 每個建議都要有充分理由
3. **保留最終決定權** - 系統建議但人工確認
4. **重視歷史經驗** - 參考過往類似案例

## 🚀 開發指令

**請基於以上完整上下文，開發一個完整的凱基銀行法務條款管理系統。**

**特別要求：**
1. 使用 LangGraph 實現工作流
2. 整合 Gemini API 進行條款分析
3. 使用 SQLite 作為初期資料庫
4. 提供 Web 介面供法務使用
5. 實現條款比對和差異分析的核心邏輯
6. 確保系統輸出符合銀行業法務的專業要求

**交付物：**
- 完整的 Python 後端代碼
- LangGraph 工作流實現
- 資料庫初始化腳本
- Web 前端介面
- API 文檔
- 部署說明文檔

請開始開發！